# Repository Guidelines

## Project Structure & Module Organization
- `src/` holds the firmware entry points (`ratgdo.cpp`, `homekit.cpp`, etc.), with `src/www/` serving the prebuilt web UI that gets regenerated by `build_web_content.py`.
- `lib/ratgdo` implements board-level abstractions (door control, LED, vehicle sensing); `lib/secplus` provides Chamberlain Security+ protocol support.
- `docs/` contains user-facing references and images used by the web flasher; sync any new assets there.
- Root helper scripts (`auto_firmware_version.py`, `build_flags.py`, `verify_firmware.sh`, `upload_firmware.sh`) orchestrate build metadata, web assets, and deploymentâ€”update them in tandem with firmware changes.

## Build, Test, and Development Commands
- `pio run -e ratgdo_esp32dev` compiles the firmware using the custom Espressif32 platform fork defined in `platformio.ini`.
- `pio run -e ratgdo_esp32dev -t upload --upload-port /dev/cu.usbserial-XXXX` flashes a device over USB; adjust the port for your workstation.
- `pio device monitor -e ratgdo_esp32dev` opens a 115200 baud serial console for runtime logs and crash summaries.
- `python3 build_web_content.py` rebuilds the SPA assets into `src/www/`; run after editing anything under `docs/webpage/`.
- `./verify_firmware.sh` compares freshly built binaries against release manifests before publishing.

## Coding Style & Naming Conventions
- Follow the existing 4-space indentation and brace-on-new-line style across `.cpp/.h` pairs.
- Use `CamelCase` for classes (`GarageDoor`), `snake_case` for variables/functions, and ALL_CAPS for macros or compile-time constants.
- Keep includes grouped (standard, ESP-IDF/Arduino, project headers) and prefer existing logging helpers (`Serial.printf`, `ESP_LOG*`) over ad hoc prints.
- Mirror the header/implementation split already in place and keep platform-specific definitions behind `#ifdef` guards.

## Testing Guidelines
- There is no dedicated unit-test target; treat `pio run` as the minimum gate and exercise changes on real hardware where possible.
- Before submitting, capture relevant serial output and confirm HomeKit pairing, vehicle sensing, and web UI assets if they were touched.
- Document manual validation steps in the PR so reviewers can reproduce them.

## Commit & Pull Request Guidelines
- Follow the short, imperative commit style used in history (e.g., `Guard subsystem setup against repeat Wi-Fi reconnects`).
- Reference affected subsystems in the subject, keep body context-specific, and link issues when available.
- PRs should describe hardware tested, attach pertinent logs or screenshots, and call out any scripts that must be rerun by maintainers.
